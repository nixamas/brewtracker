<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Brew Tracker Data Analysis</title>
	<link href="style.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" type="text/css" media="all" href="js/jsDatePick/jsDatePick_ltr.min.css" />
    <link type="text/css" rel="stylesheet" href="css/graph.css">
	<link type="text/css" rel="stylesheet" href="css/detail.css">
	<link type="text/css" rel="stylesheet" href="css/legend.css">
	<link type="text/css" rel="stylesheet" href="css/lines.css">
    
    <script id="datasource" language="javascript" type="text/javascript" src="data.js"></script>
	<script language="javascript" type="text/javascript" src="js/flot/jquery.js"></script>
	<script language="javascript" type="text/javascript" src="js/flot/jquery.flot.js"></script>
	<script language="javascript" type="text/javascript" src="js/flot/jquery.flot.time.js"></script>
	<script language="javascript" type="text/javascript" src="js/moment.js"></script>
	<script language="javascript" type="text/javascript" src="js/jsDatePick/jsDatePick.min.1.3.js"></script>
	<script src="vendor/d3.v2.js"></script>
	<script src="rickshaw.js"></script>
    <style>
</style>
</head>
<body>
	<!--Header Begin-->
	<div id="header">
	<h2>Brew Tracker</h2>
	  <div class="center">
		<div id="logo"><a href="#">Brew Tracker</a></div>
		<!--Menu Begin-->
		<div id="menu">
		  <ul>
			<li><a class="active" href="index.html"><span>Home</span></a></li>
			<li><a href="analysis.html"><span>Analysis</span></a></li>
			<li><a href="#"><span>Administrative</span></a></li>
			<li><a href="#"><span>Contact</span></a></li>
		  </ul>
		</div>
		<!--Menu END-->
	  </div>
	</div>
	<!--Header END-->

	<div id="content" >
    <p>Selected dates starting at: <input type="text" size="12" id="minDateInput" />
                        and ending at: <input type="text" size="12" id="maxDateInput" />
                        <input type="button" id="selectDatesBtn" value="Find Readings" onclick="refineResults()"/>
                        <input type="button" id="testbtn" value="TESTING" onclick="getData()"/></p>
                    <div id="chart_container" align="center">
                        <div id="y_axis"></div>
                        <div id="chart"></div>
                        <div id="legend_container">
                            <div id="smoother" title="Smoothing"></div>
                            <div id="legend"></div>
                        </div>
                        <div id="slider"></div>
                    </div>
        <table>
            <tr>
                <td align="center">
                    
                </td>
            </tr>
        </table>
    </div>
<!--		<div class="demo-container">-->
<!--			<div id="placeholder" class="demo-placeholder"></div>-->
			
<!--			<p>Selected dates starting at: <input type="text" size="12" id="minDateInput" />-->
<!--				and ending at: <input type="text" size="12" id="maxDateInput" />-->
<!--				<input type="button" id="selectDatesBtn" value="Find Readings" onclick="refineResults()"/>-->
<!--                <input type="button" id="testbtn" value="TESTING" onclick="getData()"/></p>-->
<!--		</div>-->
		
<!--	</div>-->

	<div id="footer">
		Brew Tracker -- Version 1.0
	</div>

</body>
<script type="text/javascript">

    var d = [ [moment("2013-05-07 15:10:00"),65],
					[moment("2013-05-07 15:13:00"),69],
					[moment("2013-05-07 15:16:00"),65],
					[moment("2013-05-07 15:19:00"),59],
					[moment("2013-05-07 15:22:00"),63],
					[moment("2013-05-07 15:25:00"),61],
					[moment("2013-05-07 15:28:00"),60],
					[moment("2013-05-07 15:31:00"),63],
					[moment("2013-05-07 15:34:00"),55],
					[moment("2013-05-07 15:37:00"),57],
					[moment("2013-05-07 15:40:00"),65],
					[moment("2013-05-07 15:43:00"),67],
					[moment("2013-05-07 15:47:00"),63],
					[moment("2013-05-07 15:50:00"),60],
					[moment("2013-05-08 15:53:00"),64] ];
    var DATA_READINGS = [];
    var DATA_READINGS_RICKSHAW = [];
                    
	window.onload = function(){
        console.log("init page...");
/**		new JsDatePick({
			useMode:2,
			target:"minDateInput"
			});
		new JsDatePick({
			useMode:2,
			target:"maxDateInput"
			});
            
        if(document.getElementById("minDateInput").value != ""){
            document.getElementById("minDateInput").value = "";
        }
        if(document.getElementById("maxDateInput").value != ""){
            document.getElementById("maxDateInput").value = "";
        }
*/
        
        parseDataReadings();
        plotData();
	};
	
	function parseDataReadings(){
	   console.log("parsing the data readigns...");
	   var dr = getDataReadings();
	   var drObj = JSON.parse(dr);
	   console.log("DataReadings :: " + dr);
	   console.log(drObj);
	   for(var i = 0; i< drObj.readings.length; i++){
	       console.log("parsing reading :: " + drObj.readings[i].time + " - " + drObj.readings[i].value);
	       DATA_READINGS[i] = [ (moment(drObj.readings[i].time).unix())*1000 , parseInt(drObj.readings[i].value) ];  
           DATA_READINGS_RICKSHAW[i] = {"x":( moment(drObj.readings[i].time).subtract("hours", 5).unix() ), "y": parseInt(drObj.readings[i].value)};
	   } 
	   console.log(DATA_READINGS_RICKSHAW);
	}
	
	function plotData(){
	   console.log("plotting data...");
/**	   console.log(DATA_READINGS);
	   $.plot("#placeholder", [DATA_READINGS], {
            xaxis: { mode: "time",
                    show: true,
                    ticks: 4,
                    timeformat: "%Y-%m-%d %H:%M:%S",
                    tickFormatter: "%m-%d %H:%M"}
        });*/
        
        var graph = new Rickshaw.Graph( {
            element: document.getElementById("chart"),
            width: 700,
            height: 500,
            renderer: 'line',
            interpolation: 'linear',
            series: [
                {
                    color: "steelblue",
                    data: DATA_READINGS_RICKSHAW,
                    name: 'Data Readings'
                }
            ]
        } );

        

        var hoverDetail = new Rickshaw.Graph.HoverDetail( {
            graph: graph
        } );

        var legend = new Rickshaw.Graph.Legend( {
            graph: graph,
            element: document.getElementById('legend')

        } );

        var shelving = new Rickshaw.Graph.Behavior.Series.Toggle( {
            graph: graph,
            legend: legend
        } );

        var x_axes = new Rickshaw.Graph.Axis.Time( {
            graph: graph
        } );
        
        var y_axis = new Rickshaw.Graph.Axis.Y( {
            graph: graph,
            orientation: 'left',
            tickFormat: Rickshaw.Fixtures.Number.formatKMBT,
            element: document.getElementById('y_axis'),
        } );
        
        /**x_axes.render();
        y_axis.render();*/
        
        graph.render();
	}
	
    function refineResults(){
        var minDate = document.getElementById("minDateInput").value;
        var maxDate = document.getElementById("maxDateInput").value;
        console.log("refine data results to range " + minDate + " to " + maxDate);
        $.plot("#placeholder", [DATA_READINGS], {
                xaxis: {
					mode: "time",
					show: true,
					min: moment(minDate + " 00:00:00").unix(),
					max: moment(maxDate + " 00:00:00").unix(),
					ticks: 5,
					timeformat: "%Y-%m-%d %H:%M:%S",
					tickFormatter: "%m-%d %H:%M"
				}
			});
    }
    
    
    /*****************************  RICKSHAW  *********************************/
    // set up our data series with 50 random data points

/**        var seriesData = [ [], [], [] ];
        var random = new Rickshaw.Fixtures.RandomData(150);

        for (var i = 0; i < 150; i++) {
            random.addData(seriesData);
        }

        // instantiate our graph!

        var graph = new Rickshaw.Graph( {
            element: document.getElementById("chart"),
            width: 960,
            height: 500,
            renderer: 'line',
            series: [
                {
                    color: "#c05020",
                    data: seriesData[0],
                    name: 'New York'
                }
            ]
        } );

        graph.render();

        var hoverDetail = new Rickshaw.Graph.HoverDetail( {
            graph: graph
        } );

        var legend = new Rickshaw.Graph.Legend( {
            graph: graph,
            element: document.getElementById('legend')

        } );

        var shelving = new Rickshaw.Graph.Behavior.Series.Toggle( {
            graph: graph,
            legend: legend
        } );

        var axes = new Rickshaw.Graph.Axis.Time( {
            graph: graph
        } );
        
        axes.render();
*/
    
	</script>
</html>
