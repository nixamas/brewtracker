<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Brew Tracker Data Analysis</title>
	<link type="text/css" rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css">
	<link rel="stylesheet" type="text/css" media="all" href="js/jsDatePick/jsDatePick_ltr.min.css" />
    <link type="text/css" rel="stylesheet" href="css/graph.css">
	<link type="text/css" rel="stylesheet" href="css/detail.css">
	<link type="text/css" rel="stylesheet" href="css/legend.css">
	<link type="text/css" rel="stylesheet" href="css/lines.css">
    <link type="text/css" rel="stylesheet" href="css/style.css">
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.15/jquery-ui.min.js"></script>
    
    <script language="javascript" type="text/javascript" src="data.js"></script>
    <script language="javascript" type="text/javascript" src="js/Rickshaw.js"></script>
    <script language="javascript" type="text/javascript" src="js/Rickshaw.Class.js"></script>
    <script language="javascript" type="text/javascript" src="js/Rickshaw.Compat.ClassList.js"></script>
	<script language="javascript" type="text/javascript" src="js/flot/jquery.js"></script>
	<script language="javascript" type="text/javascript" src="js/flot/jquery.flot.js"></script>
	<script language="javascript" type="text/javascript" src="js/flot/jquery.flot.time.js"></script>
	<script language="javascript" type="text/javascript" src="js/moment.js"></script>
	<script language="javascript" type="text/javascript" src="js/jsDatePick/jsDatePick.min.1.3.js"></script>
	<script language="javascript" type="text/javascript" src="js/Rickshaw.Graph.RangeSlider.js"></script>
	<script language="javascript" type="text/javascript" src="js/Rickshaw.js"></script>
	<script language="javascript" type="text/javascript" src="vendor/d3.v2.js"></script>
	<script language="javascript" type="text/javascript" src="rickshaw.js"></script>
	<script src="js/extensions.js"></script>
	<script type="text/javascript" >
//     function requestDataReadings(){
//         console.log("getting the data...")
//         $.getJSON('http://localhost:1234/datareadings.json', function(data) {
//               console.log("got the data...");
//               console.log(data);
//             });
//     }
	</script>
	<script src="js/Rickshaw.Graph.RangeSlider.js"></script>
	<script src="js/Rickshaw.js"></script>
	<script src="vendor/d3.v2.js"></script>
	<script src="rickshaw.js"></script>
	<script src="js/extensions.js"></script>
    <style>
</style>
</head>
<body>
	<!--Header Begin-->
	<div id="header">
	<h2>Brew Tracker</h2>
	  <div class="center">
		<div id="logo"><a href="#">Brew Tracker</a></div>
		<!--Menu Begin-->
		<div id="menu">
		  <ul>
			<li><a href="index.html"><span>Home</span></a></li>
			<li><a href="analysis.html"><span>Analysis</span></a></li>
			<li><a href="#"><span>Administrative</span></a></li>
			<li><a href="#"><span>Contact</span></a></li>
		  </ul>
		</div>
		<!--Menu END-->
	  </div>
	</div>
	<!--Header END-->

	<div id="content" >
    <p>Selected dates starting at: <input type="text" size="12" id="minDateInput" />
                        and ending at: <input type="text" size="12" id="maxDateInput" />
                        <input type="button" id="selectDatesBtn" value="Find Readings" onclick="refineResults()"/>
                        <input type="button" id="testbtn" value="TESTING" onclick="requestDataReadings()"/></p>
                    <div id="chart_container" align="center">
	<div id="chart_container" align="center">
                        <div id="y_axis"></div>
                        <div id="chart"></div>
<!--                         <div id="slider"></div> -->
                        <div id="legend_container">
                            <div id="smoother" title="Smoothing"></div>
                            <div id="legend"></div>
                        </div>
                        <div id="slider"></div>
                    </div>
<!--     <p>Selected dates starting at: <input type="text" size="12" id="minDateInput" /> -->
<!--                         and ending at: <input type="text" size="12" id="maxDateInput" /> -->
<!--                         <input type="button" id="selectDatesBtn" value="Find Readings" onclick="refineResults()"/> -->
<!--                         <input type="button" id="testbtn" value="TESTING" onclick="getData()"/></p> -->
                    
        <table>
            <tr>
                <td align="center">
                    
                </td>
            </tr>
        </table>
    </div>
<!--		<div class="demo-container">-->
<!--			<div id="placeholder" class="demo-placeholder"></div>-->
			
<!--			<p>Selected dates starting at: <input type="text" size="12" id="minDateInput" />-->
<!--				and ending at: <input type="text" size="12" id="maxDateInput" />-->
<!--				<input type="button" id="selectDatesBtn" value="Find Readings" onclick="refineResults()"/>-->
<!--                <input type="button" id="testbtn" value="TESTING" onclick="getData()"/></p>-->
<!--		</div>-->
		
<!--	</div>-->

	<div id="footer">
		Brew Tracker -- Version 1.0
	</div>

</body>
<script type="text/javascript">

    var DATA_READINGS_RICKSHAW = [];
    var REQUESTED_DATA_OBJECT = null;
                    
    $.getJSON('http://localhost:1234/datareadings.json', function(data) {
        console.log("got the data...");
//         console.log(data);
        REQUESTED_DATA_OBJECT = JSON.parse( data );
        parseDataReadings();
        plotData();
      });
    
    var DATA_READINGS_RICKSHAW_2 = []
                    
    $.noConflict();
	window.onload = function(){
        console.log("init page...");
		new JsDatePick({
			useMode:2,
			target:"minDateInput"
			});
		new JsDatePick({
			useMode:2,
			target:"maxDateInput"
			});
            
        if(document.getElementById("minDateInput").value != ""){
            document.getElementById("minDateInput").value = "";
        }
        if(document.getElementById("maxDateInput").value != ""){
            document.getElementById("maxDateInput").value = "";
        }

//         parseDataReadings();
//         plotData();
	};

    function parseDataReadings(){
	   console.log("parsing the data readigns...");
	   for(var i = 0; i< REQUESTED_DATA_OBJECT.readings.length; i++){
           DATA_READINGS_RICKSHAW[i] = {"x":( moment(REQUESTED_DATA_OBJECT.readings[i].time).subtract("hours", 5).unix() ), "y": parseInt(REQUESTED_DATA_OBJECT.readings[i].value)};
           DATA_READINGS_RICKSHAW_2[i] = {"x":( moment(REQUESTED_DATA_OBJECT.readings[i].time).subtract("hours", 5).unix() ), "y": parseInt(REQUESTED_DATA_OBJECT.readings[i].value * 2 )};
       }
   }

    function plotData(){
        console.log("plotting data...");
        var graph = new Rickshaw.Graph( {
            element: document.getElementById("chart"),
            width: 700,
            height: 500,
            renderer: 'line',
            interpolation: 'linear',
            series: [
                {
                    color: "steelblue",
                    data: DATA_READINGS_RICKSHAW,
                    name: 'Data Readings'
                },
                {
                    color: "red",
                    data: DATA_READINGS_RICKSHAW_2,
                    name: 'Data Readings'
                }
            ]
        } );
        var slider = new Rickshaw.Graph.RangeSlider( {
            graph: graph,
            element: $('#slider')
        } );
        var hoverDetail = new Rickshaw.Graph.HoverDetail( {
            graph: graph,
            formatter: function(series, x, y) {
                var date = '<span class="date">' + new Date(x * 1000).toUTCString() + '</span>';
                var swatch = '<span class="detail_swatch" style="background-color: ' + series.color + '"></span>';
                var content = swatch + series.name + ": " + parseInt(y) + '<br>' + date;
                return content;
            }
        } );
        var legend = new Rickshaw.Graph.Legend( {
            graph: graph,
            element: document.getElementById('legend')
        } );
        var shelving = new Rickshaw.Graph.Behavior.Series.Toggle( {
            graph: graph,
            legend: legend
        } );
        var x_axes = new Rickshaw.Graph.Axis.Time( {
            graph: graph
        } );
        var y_axis = new Rickshaw.Graph.Axis.Y( {
            graph: graph,
            orientation: 'left',
            tickFormat: Rickshaw.Fixtures.Number.formatKMBT,
            element: document.getElementById('y_axis'),
        } );
        graph.render();
	}//plotData()

	</script>
</html>
