<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Brew Tracker Data Analysis</title>
	<link href="style.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" type="text/css" media="all" href="js/jsDatePick/jsDatePick_ltr.min.css" />
    
    <script id="datasource" language="javascript" type="text/javascript" src="data.js"></script>
	<script language="javascript" type="text/javascript" src="js/flot/jquery.js"></script>
	<script language="javascript" type="text/javascript" src="js/flot/jquery.flot.js"></script>
	<script language="javascript" type="text/javascript" src="js/flot/jquery.flot.time.js"></script>
	<script language="javascript" type="text/javascript" src="js/moment.js"></script>
	<script language="javascript" type="text/javascript" src="js/jsDatePick/jsDatePick.min.1.3.js"></script>
	<script type="text/javascript">

    var d = [ [moment("2013-05-07 15:10:00"),65],
					[moment("2013-05-07 15:13:00"),69],
					[moment("2013-05-07 15:16:00"),65],
					[moment("2013-05-07 15:19:00"),59],
					[moment("2013-05-07 15:22:00"),63],
					[moment("2013-05-07 15:25:00"),61],
					[moment("2013-05-07 15:28:00"),60],
					[moment("2013-05-07 15:31:00"),63],
					[moment("2013-05-07 15:34:00"),55],
					[moment("2013-05-07 15:37:00"),57],
					[moment("2013-05-07 15:40:00"),65],
					[moment("2013-05-07 15:43:00"),67],
					[moment("2013-05-07 15:47:00"),63],
					[moment("2013-05-07 15:50:00"),60],
					[moment("2013-05-08 15:53:00"),64] ];
    var DATA_READINGS = [];
                    
	window.onload = function(){
        console.log("init page...");
		new JsDatePick({
			useMode:2,
			target:"minDateInput"
			});
		new JsDatePick({
			useMode:2,
			target:"maxDateInput"
			});
            
        if(document.getElementById("minDateInput").value != ""){
            document.getElementById("minDateInput").value = "";
        }
        if(document.getElementById("maxDateInput").value != ""){
            document.getElementById("maxDateInput").value = "";
        }
        
        parseDataReadings();
        plotData();
	};
	
	function parseDataReadings(){
	   console.log("parsing the data readigns...");
	   var dr = getDataReadings();
	   var drObj = JSON.parse(dr);
	   console.log("DataReadings :: " + dr);
	   console.log(drObj);
	   for(var i = 0; i< drObj.readings.length; i++){
	       console.log("parsing reading :: " + drObj.readings[i].time + " - " + drObj.readings[i].value);
	       DATA_READINGS[i] = [ (moment(drObj.readings[i].time).unix())*1000 , parseInt(drObj.readings[i].value) ];  
	   } 
	   console.log(DATA_READINGS);
	}
	
	function plotData(){
	   console.log("plotting data...");
	   console.log(DATA_READINGS);
	   $.plot("#placeholder", [DATA_READINGS], {
            xaxis: { mode: "time",
                    show: true,
                    ticks: 4,
                    timeformat: "%Y-%m-%d %H:%M:%S",
                    tickFormatter: "%m-%d %H:%M"}
        });
	}
	
    function refineResults(){
        var minDate = document.getElementById("minDateInput").value;
        var maxDate = document.getElementById("maxDateInput").value;
        console.log("refine data results to range " + minDate + " to " + maxDate);
        $.plot("#placeholder", [DATA_READINGS], {
                xaxis: {
					mode: "time",
					show: true,
					min: moment(minDate + " 00:00:00").unix(),
					max: moment(maxDate + " 00:00:00").unix(),
					ticks: 5,
					timeformat: "%Y-%m-%d %H:%M:%S",
					tickFormatter: "%m-%d %H:%M"
				}
			});
    }
    
	</script>
</head>
<body>
	<!--Header Begin-->
	<div id="header">
	<h2>Brew Tracker</h2>
	  <div class="center">
		<div id="logo"><a href="#">Brew Tracker</a></div>
		<!--Menu Begin-->
		<div id="menu">
		  <ul>
			<li><a class="active" href="index.html"><span>Home</span></a></li>
			<li><a href="analysis.html"><span>Analysis</span></a></li>
			<li><a href="#"><span>Administrative</span></a></li>
			<li><a href="#"><span>Contact</span></a></li>
		  </ul>
		</div>
		<!--Menu END-->
	  </div>
	</div>
	<!--Header END-->

	<div id="content">
        
		<div class="demo-container">
			<div id="placeholder" class="demo-placeholder"></div>
			
			<p>Selected dates starting at: <input type="text" size="12" id="minDateInput" />
				and ending at: <input type="text" size="12" id="maxDateInput" />
				<input type="button" id="selectDatesBtn" value="Find Readings" onclick="refineResults()"/>
                <input type="button" id="testbtn" value="TESTING" onclick="getData()"/></p>
		</div>
		
	</div>

	<div id="footer">
		Brew Tracker -- Version 1.0
	</div>

</body>
</html>
