{% extends "layout.html" %}
{% block body %}
    <div>
<!--         <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script> -->

        <script language="javascript" type="text/javascript" src="{{ url_for('static', filename='js/moment.js') }}"></script>
        <script language="javascript" type="text/javascript" src="{{ url_for('static', filename='js/highcharts/highcharts.js') }}"></script>
        <script language="javascript" type="text/javascript" src="{{ url_for('static', filename='js/highcharts/modules/exporting.js') }}"></script>
    </div>
    
    <h1>BREW TRACKER DATA ANALYSIS</h1>
    <div id="container" style="width: 100%; height: 400px; margin: 20 auto"></div>
       
  <script type="text/javascript">
    var DATA_BREW_TEMP_READINGS = [];
    var DATA_AMB_TEMP_READINGS = [];
    var REQUESTED_DATA_OBJECT = null;
    var FLASK_DATA = '{{ readings|safe }}';
    var FLASK_DATA_OBJ = null;
                    
    $(function () {
        console.log(FLASK_DATA)
        console.log( FLASK_DATA_OBJ = JSON.parse(FLASK_DATA) );
    	parseFlaskDataReadings();
        $('#container').highcharts({
            chart: {
                type: 'line',
                zoomType: 'x'
            },
            title: {
                text: 'Temperature Readings'
            },
            xAxis: {
                type: 'datetime',
                dateTimeLabelFormats: { 
                    month: '%e. %b',
                    year: '%b'
                }
            },
            yAxis: {
                title: {
                    text: 'Temperature'
                }
            },
            tooltip: {
                formatter: function() {
                        return '<b>'+ this.series.name +'</b><br/>'+
                        Highcharts.dateFormat('%e. %b - %H:%M', this.x) +'   '+ this.y +'^F';
                }
            },
            series: [{
                name: 'Brew Temperature',
                data: DATA_BREW_TEMP_READINGS
            }
            ,{
                name: 'Ambient Temperature',
                data: DATA_AMB_TEMP_READINGS
            }]
        });
    });

	function parseFlaskDataReadings(){
	       console.log("parsing the data readigns...");
	       for(var i = 0; i< parseInt( FLASK_DATA_OBJ.count ); i++){
	    	   var d = new Date( Date.parse(FLASK_DATA_OBJ.readings[i].reading_time) );
	    	   d.setHours( d.getHours() - 5 );
	    	   DATA_BREW_TEMP_READINGS[i] = [ d.getTime() , parseInt( FLASK_DATA_OBJ.readings[i].reading_brew_temp ) ];//Date.parse(FLASK_DATA_OBJ.readings[i].time)
	    	   DATA_AMB_TEMP_READINGS[i] = [ d.getTime() , parseInt( FLASK_DATA_OBJ.readings[i].reading_amb_temp ) ]
	       }
	   }

  </script>
{% endblock %}